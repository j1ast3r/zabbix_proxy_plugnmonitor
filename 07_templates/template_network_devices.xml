<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>7.0</version>
    <template_groups>
        <template_group>
            <n>Templates/Network devices</n>
        </template_group>
    </template_groups>
    <templates>
        <template>
            <template>PlugMonitor Network Device SNMP</template>
            <n>PlugMonitor Network Device SNMP</n>
            <description>Generic SNMP template for routers, switches, and network devices</description>
            <groups>
                <group>
                    <n>Templates/Network devices</n>
                </group>
            </groups>
            <items>
                <!-- System Info -->
                <item>
                    <n>Device name</n>
                    <type>SNMP_AGENT</type>
                    <snmp_oid>1.3.6.1.2.1.1.5.0</snmp_oid>
                    <key>sysName</key>
                    <delay>1h</delay>
                    <description>SNMPv2-MIB::sysName.0</description>
                </item>
                <item>
                    <n>Device description</n>
                    <type>SNMP_AGENT</type>
                    <snmp_oid>1.3.6.1.2.1.1.1.0</snmp_oid>
                    <key>sysDescr</key>
                    <delay>1h</delay>
                </item>
                <item>
                    <n>Device uptime</n>
                    <type>SNMP_AGENT</type>
                    <snmp_oid>1.3.6.1.2.1.1.3.0</snmp_oid>
                    <key>sysUpTime</key>
                    <delay>5m</delay>
                    <units>uptime</units>
                    <preprocessing>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>0.01</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <n>Device location</n>
                    <type>SNMP_AGENT</type>
                    <snmp_oid>1.3.6.1.2.1.1.6.0</snmp_oid>
                    <key>sysLocation</key>
                    <delay>1h</delay>
                </item>
                <item>
                    <n>Device contact</n>
                    <type>SNMP_AGENT</type>
                    <snmp_oid>1.3.6.1.2.1.1.4.0</snmp_oid>
                    <key>sysContact</key>
                    <delay>1h</delay>
                </item>

                <!-- ICMP Ping -->
                <item>
                    <n>ICMP ping</n>
                    <type>SIMPLE</type>
                    <key>icmpping</key>
                    <delay>1m</delay>
                    <description>0 - down, 1 - up</description>
                </item>
                <item>
                    <n>ICMP response time</n>
                    <type>SIMPLE</type>
                    <key>icmppingsec</key>
                    <delay>1m</delay>
                    <units>s</units>
                </item>
                <item>
                    <n>ICMP packet loss</n>
                    <type>SIMPLE</type>
                    <key>icmppingloss</key>
                    <delay>1m</delay>
                    <units>%</units>
                </item>

                <!-- CPU (if available) -->
                <item>
                    <n>CPU utilization</n>
                    <type>SNMP_AGENT</type>
                    <snmp_oid>1.3.6.1.4.1.9.2.1.56.0</snmp_oid>
                    <key>cpuUtil</key>
                    <delay>1m</delay>
                    <units>%</units>
                    <description>Cisco CPU utilization</description>
                </item>

                <!-- Memory (if available) -->
                <item>
                    <n>Memory utilization</n>
                    <type>SNMP_AGENT</type>
                    <snmp_oid>1.3.6.1.4.1.9.2.1.8.0</snmp_oid>
                    <key>memUtil</key>
                    <delay>5m</delay>
                    <units>%</units>
                    <description>Cisco memory utilization</description>
                </item>
            </items>

            <discovery_rules>
                <discovery_rule>
                    <n>Network interfaces discovery</n>
                    <type>SNMP_AGENT</type>
                    <snmp_oid>discovery[{#IFNAME},1.3.6.1.2.1.2.2.1.2,{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]</snmp_oid>
                    <key>ifDiscovery</key>
                    <delay>1h</delay>
                    <item_prototypes>
                        <item_prototype>
                            <n>Interface {#IFNAME}: Operational status</n>
                            <type>SNMP_AGENT</type>
                            <snmp_oid>1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}</snmp_oid>
                            <key>ifOperStatus[{#IFNAME}]</key>
                            <delay>1m</delay>
                        </item_prototype>
                        <item_prototype>
                            <n>Interface {#IFNAME}: Incoming traffic</n>
                            <type>SNMP_AGENT</type>
                            <snmp_oid>1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}</snmp_oid>
                            <key>ifInOctets[{#IFNAME}]</key>
                            <delay>1m</delay>
                            <units>bps</units>
                            <preprocessing>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>8</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                        <item_prototype>
                            <n>Interface {#IFNAME}: Outgoing traffic</n>
                            <type>SNMP_AGENT</type>
                            <snmp_oid>1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}</snmp_oid>
                            <key>ifOutOctets[{#IFNAME}]</key>
                            <delay>1m</delay>
                            <units>bps</units>
                            <preprocessing>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>8</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>last(/PlugMonitor Network Device SNMP/ifOperStatus[{#IFNAME}])=2</expression>
                            <n>Interface {#IFNAME} is down on {HOST.NAME}</n>
                            <priority>WARNING</priority>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <n>Interface {#IFNAME}: Traffic</n>
                            <graph_items>
                                <graph_item>
                                    <color>00AA00</color>
                                    <item>
                                        <host>PlugMonitor Network Device SNMP</host>
                                        <key>ifInOctets[{#IFNAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <color>3333FF</color>
                                    <item>
                                        <host>PlugMonitor Network Device SNMP</host>
                                        <key>ifOutOctets[{#IFNAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                </discovery_rule>
            </discovery_rules>

            <triggers>
                <trigger>
                    <expression>last(/PlugMonitor Network Device SNMP/icmpping)=0</expression>
                    <n>{HOST.NAME} is unreachable via ICMP</n>
                    <priority>HIGH</priority>
                </trigger>
                <trigger>
                    <expression>last(/PlugMonitor Network Device SNMP/sysUpTime)&lt;600</expression>
                    <n>{HOST.NAME} has been restarted</n>
                    <priority>INFO</priority>
                    <manual_close>YES</manual_close>
                </trigger>
            </triggers>
        </template>
    </templates>
</zabbix_export>